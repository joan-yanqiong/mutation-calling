
params {
    ref_genome = ''
    dbSNP = ''
    dbcosmic = ''
    indel_db1 = ''
    indel_db2 = ''
    gtf_path = ''
    jar_files = ''
    normal_fastq_dir = ''
    star_index_dir = 'STAR'
    hisat_index_dir = 'HISAT'
    bwa_index_dir = 'BWA'
    sample_sheet = ''
    outdir = ''
    annovar='/cluster/tools/software/annovar/20180416'
    humand_db='/cluster/projects/gaitigroup/Users/Joan/h4h-mutation-calling/data/humandb'

}

/*
========================================================================================
    Nextflow Metrics & Reports
========================================================================================
*/

timeline {
  enabled = true
  file    = "${params.outdir}/timeline.html"
  overwrite = true
}

report {
  enabled = true
  file    = "${params.outdir}/report.html"
  overwrite = true
}
trace {
  enabled = true
  fields  = 'task_id,name,status,exit,realtime,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar'
  file    = "${params.outdir}/trace.txt"
  overwrite = true
}
profiles {
    slurm {
        process {
            executor='slurm'
            withName: CREATE_FASTA_DICT {
                clusterOptions = '--job-name=CREATE_FASTA_DICT'
            }
              withName: SORT_BAM_COORD {
                clusterOptions = '--job-name=SORT_BAM_COORD'
            }
              withName: INDEX_BAM {
                clusterOptions = '--job-name=INDEX_BAM'
            }
                 withName: INDEX_BAM_HIS_NORMAL {
                clusterOptions = '--job-name=INDEX_BAM_HIS_NORMAL'
            }

                withName: INDEX_BAM_HIS_TUMOR {
                clusterOptions = '--job-name=INDEX_BAM_HIS_TUMOR'
            }

              withName: SORT_BAM_COORD_HIS_NORMAL {
                clusterOptions = '--job-name=SORT_BAM_COORD_HIS_NORMAL'
            }

              withName: SORT_BAM_COORD_HIS_TUMOR {
                clusterOptions = '--job-name=SORT_BAM_COORD_HIS_TUMOR'
            }
            withName: CONVERT_TO_AVINPUT {
                clusterOptions = '--job-name=CONVERT_TO_AVINPUT'
            }
            withName: ANNOVAR {
                clusterOptions = '--job-name=ANNOVAR'
            }
            withName: FILTERING {
                clusterOptions = '--job-name=FILTERING'
            }
            withLabel: very_short_low_mem {
                time = '00:30:00'
                cpus = 1
                memory = '16GB'
                queue = 'all'
            }

            withLabel: very_short_process {
                time = '00:30:00'
                cpus = 1
                memory = '40GB'
                queue = 'himem'
            }

            withLabel: short_process {
                time = '01:00:00'
                cpus = 1
                memory = '40GB'
                queue = 'himem'
            }

            withLabel: med_process {
                time = '06:00:00'
                cpus = 1
                memory = '40GB'
                queue = 'himem'
            }

            withLabel: long_process {
                time = '24:00:00'
                cpus = 1
                memory = '40GB'
                queue = 'himem'
            }

            withName: STAR_INDEX {
                time = '01:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=STAR_INDEX'
            }
            withName: STAR_ALIGN {
                time = '10:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=STAR_ALIGN'
            }

            withName: ADD_READ_GROUPS {
                time = '06:00:00'
                cpus = 1
                memory = '4GB'
                queue = 'all'
                clusterOptions = '--job-name=ADD_READ_GROUPS'
            }

            withName: ADD_READ_GROUPS_NORMAL {
                time = '06:00:00'
                cpus = 1
                memory = '4GB'
                queue = 'all'
                clusterOptions = '--job-name=ADD_READ_GROUPS_NORMAL'
            }

            withName: BWA_INDEX {
                time = '10:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=BWA_INDEX'
            }

            withName: MARK_DUPLICATES {
                time = '06:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=MARK_DUPLICATES'
            }
            withName: SPLIT_CIGARS {
                time = '06:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=SPLIT_CIGARS'
            }

            withName: BQSR_TABLE {
                time = '10:00:00'
                cpus = 1
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=BQSR_TABLE'
            }

            withName: APPLY_BQSR {
                time = '10:00:00'
                cpus = 1
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=APPLY_BQSR'
            }
            withName: MUTECT_R1 {
                time = '10:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=MUTECT_R1'
            }

            withName: ONCOTATOR {
                time = '10:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=ONCOTATOR'
            }

            withName: BWA_ALIGN {
                time = '24:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=BWA_ALIGN'
            }

            withName: MARK_DUPLICATES_NORMAL {
                time = '10:00:00'
                cpus = 1
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=MARK_DUPLICATES_NORMAL'
            }

            withName: INDEL_REALIGN_TARGET {
                time = '20:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=index_and_indel_realign_target'
            }

            withName: INDEL_REALIGNER {
                time = '20:00:00'
                cpus = 1
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=indel_realigner'
            }

            withName: NORMAL_BQSR_TABLE {
                time = '10:00:00'
                cpus = 1
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=normal_bqsr_table'
            }

            withName: NORMAL_APPLY_BQSR {
                time = '10:00:00'
                cpus = 1
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=NORMAL_APPLY_BQSR'

            }
            withLabel: realign_preprocess {
                time = '07:00:00'
                cpus = 1
                memory = '40GB'
                queue = 'himem'
                errorStrategy = 'ignore'
            }

            withName: TUMOR_REALIGN_PREPROCESS {
                clusterOptions = '--job-name=TUMOR_REALIGN_PREPROCESS'
            }
            withName: NORMAL_REALIGN_PREPROCESS {
                clusterOptions = '--job-name=NORMAL_REALIGN_PREPROCESS'
            }

            withName: SORT_BAM {
                time = '06:00:00'
                cpus = 6
                memory = '20GB'
                queue = 'himem'
                clusterOptions = '--job-name=SORT_BAM'
            }

            withLabel: realign_annotate {
                time = '10:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
            }

            withName: HISAT_INDEX {
                time = '10:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=HISAT_INDEX'
            }

            withLabel: hisat_align {
                time = '12:00:00'
                cpus = 6
                memory = '80GB'
                queue = 'veryhimem'
            }
            withName: TUMOR_HISAT_ALIGN {
                clusterOptions = '--job-name=TUMOR_HISAT_ALIGN'
            }
            withName: PAIR_HISAT_ALIGN {
                clusterOptions = '--job-name=MATCHED_HISAT_ALIGN'
            }

            withLabel: sam_to_bam {
                time = '01:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
            }
            withName: SAM_TO_BAM {
                clusterOptions = '--job-name=SAM_TO_BAM'
            }
            withName: HISAT_ALIGN_TUMOR_BAM {
                clusterOptions = '--job-name=HISAT_ALIGN_TUMOR_BAM'
            }
            withName: HISAT_ALIGN_PAIR_BAM {
                clusterOptions = '--job-name=HISAT_ALIGN_PAIR_BAM'
            }

            withName: MUTECT_R2 {
                time = '10:00:00'
                cpus = 6
                memory = '40GB'
                queue = 'himem'
                clusterOptions = '--job-name=MUTECT_R2'

            }
        }
    }

    standard {
        conda.enabled=true
        process {
            executor = 'local'
        }
    }
}


manifest {
  name = 'mutation_calling'
  author = 'GaitiLab UHN'
  homePage = 'https://github.com/GaitiLab/scRNA-utils'
  description = 'Nextflow module for mutation calling from bulkRNAseq'
  mainScript = 'main.nf'
}